<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>FastAPI에 2개 이상의 DB연동하기 | LiamCoding</title>

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>FastAPI에 2개 이상의 DB연동하기 | LiamCoding</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="FastAPI에 2개 이상의 DB연동하기" />
<meta name="author" content="Liam" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="💡 Intro 원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, ASGI를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다. FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 tiangolo님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌 🔎 그전에! FastAPI란? 공식 문서에는 다음과 같이 설명되어져 있습니다. FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints. 주요기능: Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다. Fast to code Fewer bugs Intuitive Easy Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다. Robust: 문서 자동화 및 쉬운 배포가 가능하다. Standards-based: 개방형 API 표준(OpenAPI&amp;JSON)을 기반으로 한다. 이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다. 📚 Multiple databases 설정하기 📕 1. settings.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 import os from functools import lru_cache from pydantic import BaseSettings _VERSION_ = &quot;0.1.0&quot; ###multiple databases-1 class ISettings(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;root&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings(ISettings): pass class ProductionSettings(ISettings): debug = False ###multiple databases-2 class ISettings2(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;admin&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings2(ISettings2): pass class ProductionSettings2(ISettings2): debug = False @lru_cache() def get_settings(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings, &quot;production&quot;: ProductionSettings, &quot;default&quot;: DevelopmentSettings, } return configs.get(config, DevelopmentSettings)() @lru_cache() def get_settings2(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings2, &quot;production&quot;: ProductionSettings2, &quot;default&quot;: DevelopmentSettings2, } return configs.get(config, DevelopmentSettings2)() 📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 @lru_cache를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다. 📘 2. database.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from api.settings import get_settings, get_settings2 Base_1 = declarative_base() Base_2 = declarative_base() SQLALCHEMY_DATABASE_URL = get_settings().db_dsn SQLALCHEMY_DATABASE_URL2 = get_settings2().db_dsn ###multiple databases-1 engine1 = create_engine(SQLALCHEMY_DATABASE_URL) SessionLocal1 = sessionmaker(autocommit=False, autoflush=False, bind=engine1) ###multiple databases-2 engine2 = create_engine(SQLALCHEMY_DATABASE_URL2) SessionLocal2 = sessionmaker(autocommit=False, autoflush=False, bind=engine2) def get_db(): session = SessionLocal1() try: yield session session.commit() finally: session.close() def get_db2(): session = SessionLocal2() try: yield session session.commit() finally: session.close() 📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 ORM(Object Relational Mapping) 이라고 합니다. 그 중에서도 sqlalchemy은 python의 대표적인 ORM입니다. 📒 3. model.py 1 2 3 4 5 6 7 8 from api.database import Base_1, Base_2 from api.models.base_model import ModelBase class DB_Schema1(Base_1, ModelBase): __tablename__ = &quot;DB_Schema1_table&quot; class DB_Schema2(Base_2, ModelBase): __tablename__ = &quot;DB_Schema2_table&quot; 📗 4. route.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from fastapi import APIRouter, Depends, Body from api.database import get_db, get_db2 router = APIRouter() @router.get( &quot;/items/get_db1&quot;, description=&quot;multiple DB&quot; ) async def get_db1( db=Depends(get_db), ): return True @router.get( &quot;/items/get_db2&quot;, description=&quot;multiple DB&quot; ) async def get_db2( db=Depends(get_db2), ): return True [참고자료] https://blog.neonkid.xyz/253 pydantic - BaseSettings FastAPI - pydantic BaseSettings예제" />
<meta property="og:description" content="💡 Intro 원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, ASGI를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다. FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 tiangolo님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌 🔎 그전에! FastAPI란? 공식 문서에는 다음과 같이 설명되어져 있습니다. FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints. 주요기능: Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다. Fast to code Fewer bugs Intuitive Easy Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다. Robust: 문서 자동화 및 쉬운 배포가 가능하다. Standards-based: 개방형 API 표준(OpenAPI&amp;JSON)을 기반으로 한다. 이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다. 📚 Multiple databases 설정하기 📕 1. settings.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 import os from functools import lru_cache from pydantic import BaseSettings _VERSION_ = &quot;0.1.0&quot; ###multiple databases-1 class ISettings(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;root&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings(ISettings): pass class ProductionSettings(ISettings): debug = False ###multiple databases-2 class ISettings2(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;admin&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings2(ISettings2): pass class ProductionSettings2(ISettings2): debug = False @lru_cache() def get_settings(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings, &quot;production&quot;: ProductionSettings, &quot;default&quot;: DevelopmentSettings, } return configs.get(config, DevelopmentSettings)() @lru_cache() def get_settings2(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings2, &quot;production&quot;: ProductionSettings2, &quot;default&quot;: DevelopmentSettings2, } return configs.get(config, DevelopmentSettings2)() 📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 @lru_cache를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다. 📘 2. database.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from api.settings import get_settings, get_settings2 Base_1 = declarative_base() Base_2 = declarative_base() SQLALCHEMY_DATABASE_URL = get_settings().db_dsn SQLALCHEMY_DATABASE_URL2 = get_settings2().db_dsn ###multiple databases-1 engine1 = create_engine(SQLALCHEMY_DATABASE_URL) SessionLocal1 = sessionmaker(autocommit=False, autoflush=False, bind=engine1) ###multiple databases-2 engine2 = create_engine(SQLALCHEMY_DATABASE_URL2) SessionLocal2 = sessionmaker(autocommit=False, autoflush=False, bind=engine2) def get_db(): session = SessionLocal1() try: yield session session.commit() finally: session.close() def get_db2(): session = SessionLocal2() try: yield session session.commit() finally: session.close() 📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 ORM(Object Relational Mapping) 이라고 합니다. 그 중에서도 sqlalchemy은 python의 대표적인 ORM입니다. 📒 3. model.py 1 2 3 4 5 6 7 8 from api.database import Base_1, Base_2 from api.models.base_model import ModelBase class DB_Schema1(Base_1, ModelBase): __tablename__ = &quot;DB_Schema1_table&quot; class DB_Schema2(Base_2, ModelBase): __tablename__ = &quot;DB_Schema2_table&quot; 📗 4. route.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from fastapi import APIRouter, Depends, Body from api.database import get_db, get_db2 router = APIRouter() @router.get( &quot;/items/get_db1&quot;, description=&quot;multiple DB&quot; ) async def get_db1( db=Depends(get_db), ): return True @router.get( &quot;/items/get_db2&quot;, description=&quot;multiple DB&quot; ) async def get_db2( db=Depends(get_db2), ): return True [참고자료] https://blog.neonkid.xyz/253 pydantic - BaseSettings FastAPI - pydantic BaseSettings예제" />
<link rel="canonical" href="http://localhost:4000/fastapi-multipledb/" />
<meta property="og:url" content="http://localhost:4000/fastapi-multipledb/" />
<meta property="og:site_name" content="LiamCoding" />
<meta property="og:image" content="http://localhost:4000/assets/images/logo-background2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-30T21:33:15+09:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"FastAPI에 2개 이상의 DB연동하기","dateModified":"2022-03-30T21:33:15+09:00","datePublished":"2022-03-30T21:33:15+09:00","image":"http://localhost:4000/assets/images/logo-background2.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logo.png"},"name":"Liam"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/fastapi-multipledb/"},"author":{"@type":"Person","name":"Liam"},"description":"💡 Intro 원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, ASGI를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다. FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 tiangolo님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌 🔎 그전에! FastAPI란? 공식 문서에는 다음과 같이 설명되어져 있습니다. FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints. 주요기능: Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다. Fast to code Fewer bugs Intuitive Easy Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다. Robust: 문서 자동화 및 쉬운 배포가 가능하다. Standards-based: 개방형 API 표준(OpenAPI&amp;JSON)을 기반으로 한다. 이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다. 📚 Multiple databases 설정하기 📕 1. settings.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 import os from functools import lru_cache from pydantic import BaseSettings _VERSION_ = &quot;0.1.0&quot; ###multiple databases-1 class ISettings(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;root&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings(ISettings): pass class ProductionSettings(ISettings): debug = False ###multiple databases-2 class ISettings2(BaseSettings): db_engine: str = &quot;mysql+pymysql&quot; db_host: str = &quot;&quot; db_user: str = &quot;admin&quot; db_password: str = &quot;&quot; db_port: int = 3306 db_database: str = &quot;&quot; debug: bool = True kakao_rest_key = &quot;&quot; @property def db_dsn(self): dsn = f&quot;{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}&quot; return dsn class DevelopmentSettings2(ISettings2): pass class ProductionSettings2(ISettings2): debug = False @lru_cache() def get_settings(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings, &quot;production&quot;: ProductionSettings, &quot;default&quot;: DevelopmentSettings, } return configs.get(config, DevelopmentSettings)() @lru_cache() def get_settings2(): config = os.environ.get(&quot;FASTAPI_CONFIG&quot;, &quot;default&quot;) configs = { &quot;development&quot;: DevelopmentSettings2, &quot;production&quot;: ProductionSettings2, &quot;default&quot;: DevelopmentSettings2, } return configs.get(config, DevelopmentSettings2)() 📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 @lru_cache를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다. 📘 2. database.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 from sqlalchemy import create_engine from sqlalchemy.ext.declarative import declarative_base from sqlalchemy.orm import sessionmaker from api.settings import get_settings, get_settings2 Base_1 = declarative_base() Base_2 = declarative_base() SQLALCHEMY_DATABASE_URL = get_settings().db_dsn SQLALCHEMY_DATABASE_URL2 = get_settings2().db_dsn ###multiple databases-1 engine1 = create_engine(SQLALCHEMY_DATABASE_URL) SessionLocal1 = sessionmaker(autocommit=False, autoflush=False, bind=engine1) ###multiple databases-2 engine2 = create_engine(SQLALCHEMY_DATABASE_URL2) SessionLocal2 = sessionmaker(autocommit=False, autoflush=False, bind=engine2) def get_db(): session = SessionLocal1() try: yield session session.commit() finally: session.close() def get_db2(): session = SessionLocal2() try: yield session session.commit() finally: session.close() 📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 ORM(Object Relational Mapping) 이라고 합니다. 그 중에서도 sqlalchemy은 python의 대표적인 ORM입니다. 📒 3. model.py 1 2 3 4 5 6 7 8 from api.database import Base_1, Base_2 from api.models.base_model import ModelBase class DB_Schema1(Base_1, ModelBase): __tablename__ = &quot;DB_Schema1_table&quot; class DB_Schema2(Base_2, ModelBase): __tablename__ = &quot;DB_Schema2_table&quot; 📗 4. route.py 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 from fastapi import APIRouter, Depends, Body from api.database import get_db, get_db2 router = APIRouter() @router.get( &quot;/items/get_db1&quot;, description=&quot;multiple DB&quot; ) async def get_db1( db=Depends(get_db), ): return True @router.get( &quot;/items/get_db2&quot;, description=&quot;multiple DB&quot; ) async def get_db2( db=Depends(get_db2), ): return True [참고자료] https://blog.neonkid.xyz/253 pydantic - BaseSettings FastAPI - pydantic BaseSettings예제","url":"http://localhost:4000/fastapi-multipledb/","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
<link href="/assets/css/screen.css" rel="stylesheet">

<link href="/assets/css/main.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

    <div class="container pr-0">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
    <img src="/assets/images/logo.png" alt="LiamCoding">
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                <a class="nav-link defaultword" href="/index.html">Blog</a>
                </li>

                <li class="nav-item">
                <a class="nav-link defaultword" href="/about">About</a>
                </li>

                <li class="nav-item">
                <a target="_blank" class="nav-link defaultword" href="https://github.com/liampoet"><i class="fab fa-github"></i> Github</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">LiamCoding</h1>
    <p class="defaultword lead">
        Hello! I'm Liam 👋I'm a developer working at ./-
    </p>

    <!--구글 광고(google analytics)-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4273395262535395"
     crossorigin="anonymous"></script>
</div>

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=FastAPI에 2개 이상의 DB연동하기&url=http://localhost:4000/fastapi-multipledb/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=http://localhost:4000/fastapi-multipledb/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/fastapi-multipledb/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/341e587e52b4402086ddb8d2ffc9e48b?s=250&d=mm&r=x" alt="Liam">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://www.linkedin.com/in/kwongmin-lim-32b828247/">Liam</a><a target="_blank" href="https://www.linkedin.com/in/kwongmin-lim-32b828247/" class="btn follow">Follow</a><br>
                        <span class="author-description">공부하는 중입니다🥸</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">FastAPI에 2개 이상의 DB연동하기</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="/assets/images/logo-background2.png" alt="FastAPI에 2개 이상의 DB연동하기">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p><br />
<br /></p>

<h2 id="-intro">💡 Intro</h2>

<ul>
  <li>원래 flask를 주로 사용하는데 지인분의 추천으로 FastAPI를 알게 되었습니다. FastAPI에서 libuv(node.js 성능의 핵심)를 코어로 사용하는 uvloop가 너무 매력적 이었고, <a href="https://asgi.readthedocs.io/en/latest/specs/main.html">ASGI</a>를 한번 사용해보고싶어서 FastAPI를 한번 사용해볼까..? 라는 마음으로 사용해 보게 되었습니다.</li>
  <li>FastAPI로 관리자 웹을 만들다가 기존에 연결해 두었던 DB에 한개를 추가로 더 연결해서 MultipleDatabases를 구성해야하는 상황이 발생했습니다. 생각보다 reference가 많이 없었는데, FastAPI의 제작자이신 <a href="https://github.com/tiangolo/fastapi/issues/2592">tiangolo</a>님의 issues에서 이 문제를 찾을 수 있었습니다. Multipledatabases에 대해 다양한분들의 의견이 잘 정리되어있어서 이를 저의 FastAPI에 적용한것을 정리해보려고 합니다.🙌</li>
</ul>

<p><br />
<br /></p>

<h2 id="-그전에-fastapi란">🔎 그전에! FastAPI란?</h2>

<p><a href="https://fastapi.tiangolo.com/">공식 문서</a>에는 다음과 같이 설명되어져 있습니다.</p>

<p>FastAPI is a modern, fast (high-performance), web framework for building APIs with Python 3.6+ based on standard Python type hints.</p>

<p>주요기능:</p>
<ul>
  <li>Fast: NodeJS 및 Go와 비슷한 성능, 현존하는 파이썬 웹 프레임워크 중 가장 빠르다.</li>
  <li>Fast to code</li>
  <li>Fewer bugs</li>
  <li>Intuitive</li>
  <li>Easy</li>
  <li>Short: 적은버그와 코드중복을 최소화할 수 있고, 각 매개변수 선언에 여러기능을 제공해준다.</li>
  <li>Robust: 문서 자동화 및 쉬운 배포가 가능하다.</li>
  <li>Standards-based: 개방형 API 표준(OpenAPI&amp;JSON)을 기반으로 한다.</li>
</ul>

<p>이것만 아니라, 현재 아직 많은 레퍼런스가 나와있지는 않지만 그것을 매꿔줄 매우매우 수준높은 공식문서가 잘 마련되어져 있었습니다. 또한 백엔드 엔지니어 입장에서 API를 사용할 수 있도록 만든 문서 작업이 생각보다 많은 시간이 소요되는데, FastAPI는 문서의 자동화를 제공해줌으로써 개발자가 문서 작업에 할애하는 시간을 줄이고 오직 코드에만 집중할 수 있도록 해주어서 업무 효율을 증진 시켜줄 수 있습니다.</p>

<p><br />
<br /></p>

<h2 id="-multiple-databases-설정하기">📚 Multiple databases 설정하기</h2>

<p><br /></p>

<h3 id="-1-settingspy">📕 1. settings.py</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseSettings</span>

<span class="n">_VERSION_</span> <span class="o">=</span> <span class="s">"0.1.0"</span>

<span class="c1">###multiple databases-1
</span><span class="k">class</span> <span class="nc">ISettings</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">db_engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"mysql+pymysql"</span>
    <span class="n">db_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">db_user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"root"</span>
    <span class="n">db_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">db_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3306</span>
    <span class="n">db_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>

    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">kakao_rest_key</span> <span class="o">=</span> <span class="s">""</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">db_dsn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dsn</span> <span class="o">=</span> <span class="n">f</span><span class="s">"{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}"</span>
        <span class="k">return</span> <span class="n">dsn</span>    

<span class="k">class</span> <span class="nc">DevelopmentSettings</span><span class="p">(</span><span class="n">ISettings</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ProductionSettings</span><span class="p">(</span><span class="n">ISettings</span><span class="p">):</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>


<span class="c1">###multiple databases-2
</span><span class="k">class</span> <span class="nc">ISettings2</span><span class="p">(</span><span class="n">BaseSettings</span><span class="p">):</span>
    <span class="n">db_engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"mysql+pymysql"</span>
    <span class="n">db_host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">db_user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"admin"</span>
    <span class="n">db_password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">db_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3306</span>
    <span class="n">db_database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">""</span>

    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">kakao_rest_key</span> <span class="o">=</span> <span class="s">""</span>

    <span class="o">@</span><span class="nb">property</span>
    <span class="k">def</span> <span class="nf">db_dsn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dsn</span> <span class="o">=</span> <span class="n">f</span><span class="s">"{self.db_engine}://{self.db_user}:{self.db_password}@{self.db_host}:{self.db_port}/{self.db_database}"</span>
        <span class="k">return</span> <span class="n">dsn</span>    

<span class="k">class</span> <span class="nc">DevelopmentSettings2</span><span class="p">(</span><span class="n">ISettings2</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ProductionSettings2</span><span class="p">(</span><span class="n">ISettings2</span><span class="p">):</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>


<span class="o">@</span><span class="n">lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_settings</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"FASTAPI_CONFIG"</span><span class="p">,</span> <span class="s">"default"</span><span class="p">)</span>
    <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"development"</span><span class="p">:</span> <span class="n">DevelopmentSettings</span><span class="p">,</span>
        <span class="s">"production"</span><span class="p">:</span> <span class="n">ProductionSettings</span><span class="p">,</span>
        <span class="s">"default"</span><span class="p">:</span> <span class="n">DevelopmentSettings</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DevelopmentSettings</span><span class="p">)()</span>

<span class="o">@</span><span class="n">lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_settings2</span><span class="p">():</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"FASTAPI_CONFIG"</span><span class="p">,</span> <span class="s">"default"</span><span class="p">)</span>
    <span class="n">configs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"development"</span><span class="p">:</span> <span class="n">DevelopmentSettings2</span><span class="p">,</span>
        <span class="s">"production"</span><span class="p">:</span> <span class="n">ProductionSettings2</span><span class="p">,</span>
        <span class="s">"default"</span><span class="p">:</span> <span class="n">DevelopmentSettings2</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">configs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">DevelopmentSettings2</span><span class="p">)()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>📌 functools - @lru_cache** : LRU(Least Recently Used)캐싱을 사용하기위해 <strong>@lru_cache</strong>를 사용했습니다. @lru_cache 데코레이터는 functools 내장 모듈로 부터 불러올 수 있으며, @lru_cache 를 아무 함수 위에 선언하면 사용하면 그 함수에 넘어온 인자를 키(key)로 함수의 호출 결과를 값(value)으로 LRU캐싱이 적용됩니다.</p>

<p><br /></p>

<h3 id="-2-databasepy">📘 2. database.py</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>

<span class="kn">from</span> <span class="nn">api.settings</span> <span class="kn">import</span> <span class="n">get_settings</span><span class="p">,</span> <span class="n">get_settings2</span>

<span class="n">Base_1</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">Base_2</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="n">SQLALCHEMY_DATABASE_URL</span> <span class="o">=</span> <span class="n">get_settings</span><span class="p">()</span><span class="o">.</span><span class="n">db_dsn</span>
<span class="n">SQLALCHEMY_DATABASE_URL2</span> <span class="o">=</span> <span class="n">get_settings2</span><span class="p">()</span><span class="o">.</span><span class="n">db_dsn</span>

<span class="c1">###multiple databases-1
</span><span class="n">engine1</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL</span><span class="p">)</span>
<span class="n">SessionLocal1</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="n">engine1</span><span class="p">)</span>

<span class="c1">###multiple databases-2
</span><span class="n">engine2</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">SQLALCHEMY_DATABASE_URL2</span><span class="p">)</span>
<span class="n">SessionLocal2</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">autocommit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bind</span><span class="o">=</span><span class="n">engine2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">SessionLocal1</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
<span class="k">def</span> <span class="nf">get_db2</span><span class="p">():</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">SessionLocal2</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">session</span>
        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>📌 sqlalchemy : SQL 문법 없이 개발 중인 언어로 데이터베이스에 접근할 수 있게 해주는 라이브러리를 <strong>ORM(Object Relational Mapping)</strong> 이라고 합니다. 그 중에서도 <a href="https://www.sqlalchemy.org/"><strong>sqlalchemy</strong></a>은 python의 대표적인 ORM입니다.</p>

<p><br /></p>

<h3 id="-3-modelpy">📒 3. model.py</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">api.database</span> <span class="kn">import</span> <span class="n">Base_1</span><span class="p">,</span> <span class="n">Base_2</span> 
<span class="kn">from</span> <span class="nn">api.models.base_model</span> <span class="kn">import</span> <span class="n">ModelBase</span>

<span class="k">class</span> <span class="nc">DB_Schema1</span><span class="p">(</span><span class="n">Base_1</span><span class="p">,</span> <span class="n">ModelBase</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"DB_Schema1_table"</span>

<span class="k">class</span> <span class="nc">DB_Schema2</span><span class="p">(</span><span class="n">Base_2</span><span class="p">,</span> <span class="n">ModelBase</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"DB_Schema2_table"</span> 
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<h3 id="-4-routepy">📗 4. route.py</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">APIRouter</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Body</span>
<span class="kn">from</span> <span class="nn">api.database</span> <span class="kn">import</span> <span class="n">get_db</span><span class="p">,</span> <span class="n">get_db2</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>


<span class="o">@</span><span class="n">router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">"/items/get_db1"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"multiple DB"</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_db1</span><span class="p">(</span>
    <span class="n">db</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db</span><span class="p">),</span>
<span class="p">):</span>
    
    <span class="k">return</span> <span class="bp">True</span>
    
    
<span class="o">@</span><span class="n">router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="s">"/items/get_db2"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s">"multiple DB"</span>
<span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_db2</span><span class="p">(</span>
    <span class="n">db</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_db2</span><span class="p">),</span>
<span class="p">):</span>
    
    <span class="k">return</span> <span class="bp">True</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br />
<br /></p>

<p><strong>[참고자료]</strong></p>
<ul>
  <li><a href="https://blog.neonkid.xyz/253">https://blog.neonkid.xyz/253</a></li>
  <li><a href="https://pydantic-docs.helpmanual.io/usage/settings/">pydantic - BaseSettings</a></li>
  <li><a href="https://fastapi.tiangolo.com/advanced/settings/">FastAPI - pydantic BaseSettings예제</a></li>
</ul>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2022-03-30">30 Mar 2022</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#FastAPI">FastAPI</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/categories#Python">Python</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="http://localhost:4000//lambda-bootpay/"> &laquo; AWS Lambda에 Bootpay연동하기 - 결제 검증</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="http://localhost:4000//lambda-cloudwatch1/">Amazon EventBridge로 특정시간에 자동으로 카운트해보기 -1 &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'demowebsite'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


<!-- Bottom Alert Bar
================================================== -->
<div class="alertbar">
	<div class="container text-center">
		<span><img src="/assets/images/logo.png" alt="LiamCoding"> &nbsp; Never miss a <b>story</b> from us, subscribe to our newsletter</span>
        <form action="https://wowthemes.us11.list-manage.com/subscribe/post?u=8aeb20a530e124561927d3bd8&amp;id=8c3d2d214b" method="post" name="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate>
            <div class="mc-field-group">
            <input type="email" placeholder="Email" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required>
            <input type="submit" value="Subscribe" name="subscribe" class="heart">
            </div>
        </form>
	</div>
</div>

    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">🔮 Category <span class="d-none d-md-inline"> ></span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/categories#AWS">AWS (7)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Python">Python (6)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Bootpay">Bootpay (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#FastAPI">FastAPI (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS-Lambda">AWS Lambda (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#EventBridge">EventBridge (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Aamazon-Cloudwatch">Aamazon Cloudwatch (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Javascript">Javascript (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#jQuery">jQuery (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#MySQL">MySQL (4)</a>
                
                    <a class="mt-1 mb-1" href="/categories#HTML">HTML (2)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Json">Json (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Postman">Postman (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#AWS-RDS">AWS RDS (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Interview">Interview (3)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Docker">Docker (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#K8S">K8S (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#ALB">ALB (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#CDN">CDN (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Diary">Diary (1)</a>
                
                    <a class="mt-1 mb-1" href="/categories#Kafka">Kafka (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2022 LiamCoding 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net
            </div>
        </div>
    </div>

    <!--구글 광고(google analytics)-->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4273395262535395"
     crossorigin="anonymous"></script>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>


<script src="/assets/js/lazyload.js"></script>


<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//demowebsite.disqus.com/count.js"></script>


</body>
</html>
